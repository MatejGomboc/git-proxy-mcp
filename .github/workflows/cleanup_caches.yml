name: Cleanup GitHub Actions Caches

# Manual trigger only - use when you want to proactively clean up
on:
    workflow_dispatch:
        inputs:
            stale_days:
                description: 'Delete caches not accessed in N days (0 = all caches)'
                required: false
                type: number
                default: 7
            dry_run:
                description: 'Log actions without deleting (for testing)'
                required: false
                type: boolean
                default: false

jobs:
    cleanup:
        name: Cleanup Caches
        runs-on: ubuntu-latest

        permissions:
            actions: write
            contents: read

        steps:
            - name: Checkout repository
              uses: actions/checkout@v6

            - name: Run cleanup script
              uses: actions/github-script@v8
              env:
                  INPUT_STALE_DAYS: ${{ inputs.stale_days || 0 }}
                  INPUT_DRY_RUN: ${{ inputs.dry_run || false }}
              with:
                  script: |
                      const cleanupScript = require('./.github/scripts/cleanup-caches.js');
                      await cleanupScript({ github, context, core });
